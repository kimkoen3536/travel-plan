package kke.travelplan;import android.app.Activity;import android.app.ProgressDialog;import android.content.Intent;import android.graphics.Bitmap;import android.net.Uri;import android.os.Bundle;import android.provider.MediaStore;import android.util.Log;import android.view.Menu;import android.view.MenuItem;import android.view.View;import android.widget.AdapterView;import android.widget.ArrayAdapter;import android.widget.EditText;import android.widget.ImageView;import android.widget.Spinner;import android.widget.TextView;import android.widget.Toast;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.FileNotFoundException;import java.io.IOException;import java.util.ArrayList;import kke.travelplan.util.DateFormats;import kke.travelplan.util.JsonHttpUtil;import kke.travelplan.util.JsonResponse;public class AddPlaceActivity extends Activity {    private TextView addressText;    private  int REQ_CODE_PICK_PICTURE = 100;    private Spinner typeSpinner;    private ImageView galleryImageView;    public static String placeType;    private EditText placeMemoText;    private Uri imageUrl;    String plan_date;    int plan_id;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_add_place);        Intent intent = getIntent();        String Address = "";               Address = intent.getStringExtra("Address");        String RoadAddress = "";           if(intent.getStringExtra("RoadAddress") != null) {               RoadAddress = intent.getStringExtra("RoadAddress");           }        String Name = "";            if(intent.getStringExtra("Name") != null) {                Name = intent.getStringExtra("Name");            }        int MapX = 0;            MapX = intent.getIntExtra("MapX", 0);        int MapY = 0;            MapY = intent.getIntExtra("MapY", 0);        System.out.println("plan_id8 ::::::::::::::::::::" + intent.getIntExtra("plan_id",0));        System.out.println("MapX :::::::::::::::::::::::::::::::::::::::::::" + MapX);        String Address_result = "";        if (intent.getStringExtra("RoadAddress") != null && intent.getStringExtra("Name") != null ) {            Address_result = Name+"("+RoadAddress+")";        }        addressText = (TextView) findViewById(R.id.address_text_view);        final ArrayList<String> list = new ArrayList();        list.add("관광");        list.add("숙박");        list.add("음식");        list.add("기타");        final ArrayAdapter adapter = new ArrayAdapter(this, android.R.layout.simple_spinner_item, list);        typeSpinner = (Spinner) findViewById(R.id.place_type_spinner);        adapter.setDropDownViewResource(android.R.layout.simple_spinner_item);        typeSpinner.setSelection(0);        typeSpinner.setAdapter(adapter);        typeSpinner.setOnItemSelectedListener(new AdapterView.OnItemSelectedListener() {            @Override            public void onItemSelected(AdapterView<?> parent, View view, int position, long id) {                placeType = String.valueOf(list.get(position));            }            @Override            public void onNothingSelected(AdapterView<?> parent) {            }        });        /*typeSpinner.setAdapter(adapter);        int i = typeSpinner.getSelectedItemPosition();        System.out.println("typeSpinner select :" + i);        typeSpinner.setSelection(i);        placeType = typeSpinner.getSelectedItem().toString();        System.out.println("placeType 1::::::::::"+placeType);*///        adapter.notifyDataSetChanged();        galleryImageView = (ImageView)findViewById(R.id.gallery_image_View);        placeMemoText =(EditText)findViewById(R.id.place_memo_text);        addressText.setText(Address_result);    }    public void galleryButtonOnClick(View view) {        Intent i = new Intent(Intent.ACTION_PICK);        i.setType(android.provider.MediaStore.Images.Media.CONTENT_TYPE);        i.setData(android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);        startActivityForResult(i, REQ_CODE_PICK_PICTURE);    }    @Override    protected void onActivityResult(int requestCode, int resultCode, Intent data) {        if (requestCode == REQ_CODE_PICK_PICTURE) if (resultCode == Activity.RESULT_OK) {            //               galleryImageView.setImageURI(data.getData());            imageUrl = data.getData();            galleryImageView.setImageURI(imageUrl);        }    }    @Override        public boolean onCreateOptionsMenu(Menu menu) {        // Inflate the menu; this adds items to the action bar if it is present.        getMenuInflater().inflate(R.menu.add_place, menu);        return true;    }    @Override    public boolean onOptionsItemSelected(MenuItem item) {        // Handle action bar item clicks here. The action bar will        // automatically handle clicks on the Home/Up button, so long        // as you specify a parent activity in AndroidManifest.xml.        int id = item.getItemId();        if (id == R.id.action_settings) {            return true;        }        return super.onOptionsItemSelected(item);    }    public void searchButtonOnClick(View view) {        Intent i = new Intent(this,SearchPlaceActivity.class);        Intent intent = getIntent();            int plan_id = intent.getIntExtra("plan_id",0);        String plan_date = intent.getStringExtra("plan_date");        i.putExtra("plan_id", plan_id);        i.putExtra("plan_date",plan_date);        startActivity(i);        finish();    }    public void saveButtonOnClick(final View view) {        final ProgressDialog dialog = new ProgressDialog(this);        dialog.setIndeterminate(true);        dialog.setMessage("계획을 저장 중입니다.");        dialog.setCancelable(false);        dialog.show();        new Thread(new Runnable() {            @Override            public void run() {                postPlace(dialog);            }        }).start();    }    public boolean postPlace(final ProgressDialog progressDialog) {        Intent intent = getIntent();        plan_id = intent.getIntExtra("plan_id",0);        System.out.println("plan_id5 ::::::::::::::::::::" + plan_id);        int MapX = 0;        MapX = intent.getIntExtra("MapX", 0);        int MapY = 0;        MapY = intent.getIntExtra("MapY", 0);        String Address;        Address = intent.getStringExtra("Address");        String RoadAddress;        RoadAddress = intent.getStringExtra("RoadAddress");        String Name;        Name = intent.getStringExtra("Name");        plan_date = intent.getStringExtra("plan_date");        byte[] b = new byte[0];        try {            Bitmap bm = MediaStore.Images.Media.getBitmap(getContentResolver(), imageUrl);            System.out.println("imageUrl ::::::::::: " + imageUrl);            System.out.println("Bitmap ::::::::::: " + bm);            ByteArrayOutputStream byteArray = new ByteArrayOutputStream();            bm.compress(Bitmap.CompressFormat.JPEG, 50, byteArray);            b = byteArray.toByteArray();            System.out.println("byte bitmap : ::::::::::::: " + b);        } catch (FileNotFoundException e) {            // TODO Auto-generated catch block            e.printStackTrace();        } catch (IOException e) {            // TODO Auto-generated catch block            e.printStackTrace();        }        Place place = new Place();        place.setPlan_id(plan_id);        place.setPlan_date(DateFormats.parseDate(plan_date));        place.setName(Name);        place.setAddress(Address);        place.setRoad_address(RoadAddress);        place.setMap_x(MapX);        place.setMap_y(MapY);        place.setType(placeType);        System.out.println("placeType 3::::::::::"+placeType);        place.setPicture(b);        place.setMemo(placeMemoText.getText().toString());        String url = App.urlPrefix + "/place/add.tpg";        final JsonResponse resp = JsonHttpUtil.post(url, place.toJson());        runOnUiThread(new Runnable() {            @Override            public void run() {                if (resp.isSuccess()) {                    progressDialog.dismiss();                    Toast.makeText(AddPlaceActivity.this, "계획을 성공적으로 등록했습니다.", Toast.LENGTH_SHORT).show();                    Intent i = new Intent(AddPlaceActivity.this,PlanItemsActivity.class);                    i.putExtra("plan_date", plan_date);                    i.putExtra("id", plan_id);                    startActivity(i);                    finish();                } else {                    progressDialog.dismiss();                    Toast.makeText(AddPlaceActivity.this, resp.getMessage(), Toast.LENGTH_SHORT).show();                }            }        });        return resp.isSuccess();    }}